parameters:
  - name: repoName
    type: string

steps:
- pwsh: '$(scriptsDirectory)/clean-typescript-files.ps1'
  displayName: 'Remove generated models and requests from the repo src folder'
  env:
    MainDirectory: '$(Build.SourcesDirectory)/${{ parameters.repoName }}/src/'

- pwsh: '$(scriptsDirectory)/copy-typescript-sdk-models.ps1'
  displayName: 'Update models'
  env:
    BuildConfiguration: $(buildConfiguration)
    OutputFullPath: $(kiotaDirectory)/output/*
    RepoModelsDir: '$(Build.SourcesDirectory)/${{ parameters.repoName }}/src/'

- pwsh : $(Build.SourcesDirectory)/${{ parameters.repoName }}/scripts/incrementMinorVersion.ps1
  displayName: 'Increment minor version number'
  workingDirectory: '$(Build.SourcesDirectory)/${{ parameters.repoName }}/scripts'

- uses: actions/checkout@v2.3.4
- name: Use Node.js ${{ matrix.node-version }}
- name: Use Node.js ${{ matrix.node-version }}
  uses: actions/setup-node@v2.4.0
  with:
    always-auth: true
    registry-url: 'https://npm.pkg.github.com'
    scope: '@microsoft'
    node-version: ${{ matrix.node-version }}
    cache: 'npm'
- run: npm ci
  env:
    NODE_AUTH_TOKEN: ${{ secrets.KIOTA_FEED_TOKEN }}

- pwsh: |
    npm i @azure/identity -S
    npm i @microsoft/kiota-abstractions -S
    npm i @microsoft/kiota-http-fetchlibrary -S
    npm i @microsoft/kiota-serialization-json -S
  displayName: 'Update typescript dependecies'
  workingDirectory: '$(Build.SourcesDirectory)/${{ parameters.repoName }}/'
